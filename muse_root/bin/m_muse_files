#! /bin/bash
##############################################################
##
## Name		:	m_muse_files
## Author	:	Bradley Atkins
## Description	:	Check for differences in the files 
##			under the muse root
## Date		:	19/09/2012
## Status	:	Reviewed 	[n]
##			Tested 		[n]
##			Released 	[n]
##
## M_JOB_HOST tx5xn
## M_GREP_PATTERN "^[[:alnum:]]+: |^/.*: |error|info|warning"
##
##############################################################
SCRIPT_NAME=m_muse_files

TARGET=${M_ROOT}/test/m_test1_dirs

#======================================
# Get a tmp and exp file
#======================================
NEW_EXP=$(m_get_exp_file ${SCRIPT_NAME}) || 
	m_fail 1 "Error:Failed to get exp file (${SCRIPT_NAME})" 
OLD_EXP=$(m_find_file ${SCRIPT_NAME}.exp) || 
	m_fail 1 "Error:Failed to find exp file (${SCRIPT_NAME})" 

#======================================
# Find the files under the muse root and
# write them to the new exp file
#======================================
m_get_file_data -s ${TARGET} > ${NEW_EXP} 

#======================================
# Get our existing exp file and diff it
# against the new one
#======================================
if [[ $(diff ${OLD_EXP} ${NEW_EXP}) ]]
then
	m_print_marker ${C_EVIDENCE_MARKER} 
	diff -s ${OLD_EXP} ${NEW_EXP} 
	m_print_marker ${C_EVIDENCE_MARKER}	
else
	echo "No differences found in file system under (${TARGET})"
fi

