#! /bin/bash
##############################################################
##
## Name		:	m_ifconfig2
## Author	:	Bradley Atkins
## Description	:	test script for dev
## Date		:	04/08/2012
## Args		:	
## Status	:	Reviewed 	[n]
##			Tested 		[n]
##			Released 	[n]
##
## M_JOB_HOST tx5xn
## M_GREP_PATTERN "^[[:alnum:]]+: |info|warning"
##
##############################################################
SCRIPT_NAME=m_ifconfig2
DEVICE=wlan0

ifconfig -a ${DEVICE}

#======================================
# Capture the inet addr line from ifconfig
#======================================
LINE=$(ifconfig -a ${DEVICE} | sed -n '/inet addr/p')
for s in ${PIPESTATUS[@]}; do [[ $s -eq 0 ]] || m_fail 1 "Error:Pipe failed (${SCRIPT_NAME})" ; done 
[[ -n ${LINE} ]] || m_fail 1 "Error:Ifconfig not recovered (${SCRIPT_NAME})" 

#======================================
# Get our addresses etc
#======================================
TMP=$(echo ${LINE} | awk '{print $2}' FS=":")
IA=${TMP% *}
TMP=$(echo ${LINE} | awk '{print $3}' FS=":")
BA=${TMP% *}
TMP=$(echo ${LINE} | awk '{print $4}' FS=":")
M=${TMP% *}

#======================================
# Check our range is acceptable
# Note this range would be recovered 
# from the muse hosts file via a function
#======================================
[[ ${IA%.*} == "192.168.1" ]] || 
	m_fail 1 "Error:Inet addr out of range (${SCRIPT_NAME})" 
[[ ${BA%.*} == "192.168.1" ]] || 
	m_fail 1 "Error:Broadcast addr out of range (${SCRIPT_NAME})" 

#======================================
# Output our addresses etc for evidence summary
#======================================
m_print_marker ${C_EVIDENCE_MARKER}

printf "\t%s\n" "Internet addr  = ${IA}"
printf "\t%s\n" "Broadcast addr = ${BA}"
printf "\t%s\n" "Mask           = ${M}"

m_print_marker ${C_EVIDENCE_MARKER}

